<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>小程序 | util 公共方法</title>
  <meta name="description" content="§ util 公共方法  开始前请把 ch2-2 分支中的 code/ 目录导入微信开发工具">

  <link rel="stylesheet" href="./css/main.css">
  <link rel="canonical" href="/ch2-2">
</head>


<body>
    <header class="site-header-box">
    <div class="site-header">
        <div class="wrapper">
            <a class="site-title" href="/">微信小程序教程</a>
            <!-- <a class="site-ikcamp">iKcamp</a> -->
            <div id="container" class="canvasbox">
                <canvas id="waterfall" width="100" height="140"></canvas>
            </div>
        </div>
    </div>
</header>
    <div class="page-content">
        <div class="wrapper markdown-body">
            <article class="post">

  <header class="post-header">
    <p class="post-title" itemprop="name headline">第二章：小程序中级实战教程：预备篇</p>
    <p class="post-meta">util 公共方法</p>
  </header>

  <div class="post-content markdown-body" itemprop="articleBody">
    <h2 id="asect-util-a"><a>§ util 公共方法</a></h2>
<blockquote>
  <p>开始前请把 <code class="highlighter-rouge">ch2-2</code> 分支中的 <code class="highlighter-rouge">code/</code> 目录导入微信开发工具</p>
</blockquote>

<p><br /></p>

<p>在这一章中，我们会在util目录新建 3 个文件，这些文件分别提供了一些常用的函数，变量，已便我们在不同的页面中使用</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  ├── utils/             
  │   ├─ config.js
  │   ├─ index.js
  │   ├─ mock.js
</code></pre>
</div>
<p><br /></p>

<h3 id="astep-1-nbsp-configjs-a"><a>Step 1.   config.js 配置常量</a></h3>
<p>该文件存放了一些 const 常量（如开发环境，默认文案，默认图片等），将这些常量存在 core 这个对象中，最后通过 <code class="highlighter-rouge">export default core</code> 将 core 这个对象导出。由于只是存放一些配置常量，此处不再复述：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="s1">'use strict'</span><span class="p">;</span>
  <span class="kr">const</span> <span class="nx">env</span> <span class="o">=</span> <span class="s1">'dev'</span><span class="p">;</span><span class="c1">// dev production</span>
  <span class="cm">/*
   * 默认接口出错弹窗文案
   * @type {string}
   */</span>
  <span class="kr">const</span> <span class="nx">defaultAlertMessage</span> <span class="o">=</span> <span class="s1">'好像哪里出了小问题~ 请再试一次~'</span><span class="p">;</span>
  <span class="cm">/*
   * 默认分享文案
   * @type 
   */</span>
  <span class="kr">const</span> <span class="nx">defaultShareText</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">en</span><span class="p">:</span> <span class="s1">'iKcamp英语-学英语口语听力四六级'</span>
  <span class="p">};</span>
  <span class="cm">/*
   * 小程序默认标题栏文字
   * @type {string}
   */</span>
  <span class="kr">const</span> <span class="nx">defaultBarTitle</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">en</span><span class="p">:</span> <span class="s1">'iKcamp英语学习'</span>
  <span class="p">};</span>
  <span class="cm">/*
   * 文章默认图片
   * @type {string}
   */</span>
  <span class="kr">const</span> <span class="nx">defaultImg</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">articleImg</span><span class="p">:</span> <span class="s1">'https://n1image.hjfile.cn/mh/2017/06/07/7e8f7b63dba6fa3849b628c0ce2c2a46.png'</span><span class="p">,</span>
      <span class="na">coverImg</span><span class="p">:</span> <span class="s1">'https://n1image.hjfile.cn/mh/2017/06/07/7472c035ad7fe4b8db5d2b20e84f9374.png'</span>
  <span class="p">};</span>
  <span class="kd">let</span> <span class="nx">core</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">env</span><span class="p">:</span> <span class="nx">env</span><span class="p">,</span>
      <span class="na">defaultBarTitle</span><span class="p">:</span> <span class="nx">defaultBarTitle</span><span class="p">[</span><span class="s1">'en'</span><span class="p">],</span>
      <span class="na">defaultImg</span><span class="p">:</span> <span class="nx">defaultImg</span><span class="p">,</span>
      <span class="na">defaultAlertMsg</span><span class="p">:</span> <span class="nx">defaultAlertMessage</span><span class="p">,</span>
      <span class="na">defaultShareText</span><span class="p">:</span> <span class="nx">defaultShareText</span><span class="p">[</span><span class="s1">'en'</span><span class="p">],</span>
      <span class="na">isDev</span><span class="p">:</span> <span class="nx">env</span> <span class="o">===</span> <span class="s1">'dev'</span><span class="p">,</span>
      <span class="na">isProduction</span><span class="p">:</span> <span class="nx">env</span> <span class="o">===</span> <span class="s1">'production'</span>
  <span class="p">};</span>
  <span class="kr">export</span> <span class="k">default</span> <span class="nx">core</span><span class="p">;</span>
</code></pre>
</div>
<p><br /></p>

<h3 id="astep-2-nbsp-mockjs-a"><a>Step 2.   mock.js 数据</a></h3>
<p>该文件用来存放一些假数据，方便本地开发调试，如果你有 mock 服务器，当然更好</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="kr">const</span> <span class="nx">list</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">articles</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1177432</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/26/9ffa8c56cfd76cf5159011f4017f022e.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-27 00:45:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"Quora精选：为什么聪明人总能保持冷静？"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1176561</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/26/0eb29c4c08e7be93f74ce9ce0fd5a25e.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-27 00:30:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"与时间有关的英语俚语（四）"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1161967</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"http://n1image.hjfile.cn/mh/2017/05/25/5d6ce79848cc81b800959383c35dd081.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-27 00:15:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"2017.5大学英语六级口语考试真题：看图论述“人与人之间的信任”"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1177828</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/26/c99a6d180367bf1a250d6e7c6c3083c6.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-27 00:00:01"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"亚马逊卖衣服有新招！新衣服试穿一周再付钱"</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="na">date</span><span class="p">:</span> <span class="s2">"2017-06-27"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">articles</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1175100</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/23/2490fdbcfc131c0e256546da4a03f1ac.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-26 00:45:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"双语美文：小时候的自己，真是傻得可爱"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1172434</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/19/57a8ef65ee53f5921657376fd3fe4a75.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-26 00:30:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"15个和money有关的习语，可别用错了"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1161968</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"http://n1image.hjfile.cn/mh/2017/05/25/2260fb0deb74734f5ec5a375423a6b52.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-26 00:15:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"2017年5月大学英语六级口语考试真题——小组讨论之扶老人是我们的责任吗？"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1161963</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"http://n1image.hjfile.cn/mh/2017/05/25/93228c5713545ef328e708ddb73e28a2.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-26 00:15:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"2017年5月大学英语六级口语考试——优秀领导的特质"</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="na">date</span><span class="p">:</span> <span class="s2">"2017-06-26"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">articles</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1175110</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/23/a5bf85e439696829a937accfd99f0eb7.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-25 00:45:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"Quora精选：什么样的人注定无法成功？"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1142849</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/22/faf544ccf3e4f9e8da4ee9d5d8fcc635.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-25 00:30:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"表达雌性动物和雄性动物的不同说法"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1161915</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"http://n1image.hjfile.cn/mh/2017/05/25/7778bd5547fa216db57cd87a78bd790d.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-25 00:15:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"2017年5月大学英语四级口语考试——如何用PPT展现一堂课"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="na">contentId</span><span class="p">:</span> <span class="mi">1175101</span><span class="p">,</span>
            <span class="na">cover</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/23/045ed76502b0f1ccdaccdae827c17c2c.jpg"</span><span class="p">,</span>
            <span class="na">pubdate</span><span class="p">:</span> <span class="s2">"2017-06-25 00:00:00"</span><span class="p">,</span>
            <span class="na">title</span><span class="p">:</span> <span class="s2">"双语美文：总在不经意间，发觉自己渺小"</span>
          <span class="p">}</span>
        <span class="p">],</span>
        <span class="na">date</span><span class="p">:</span> <span class="s2">"2017-06-25"</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="na">message</span><span class="p">:</span> <span class="s2">"success"</span><span class="p">,</span>
    <span class="na">status</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">time</span><span class="p">:</span> <span class="kc">null</span>
  <span class="p">};</span>

  <span class="kr">const</span> <span class="nx">detail</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">agreeNum</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">articleImage</span><span class="p">:</span> <span class="s2">"https://n1image.hjfile.cn/mh/2017/06/26/9ffa8c56cfd76cf5159011f4017f022e.jpg"</span><span class="p">,</span>
      <span class="na">author</span><span class="p">:</span> <span class="s2">"Quora用户"</span><span class="p">,</span>
      <span class="na">autoSummary</span><span class="p">:</span> <span class="s2">"Why do intelligent people seem calm all the time?为什么聪明人总能保持冷静？\r\n\r\n\t\r\n\r\n\tAnswer from @Domen Grabec来自@Domen Grabec的回答\r\n\r\n\tIf you can solve your problem, then what is the n..."</span><span class="p">,</span>
      <span class="na">cateId</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">channelId</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">commentCount</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="na">content</span><span class="p">:</span> <span class="s1">'&lt;p&gt;\r\n\t&lt;img src="https://n1image.hjfile.cn/mh/2017/06/26/47d852dce02d0b47d91efd05b9d450de.jpg" /&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;strong&gt;&lt;div class="langs_en"&gt;Why do intelligent people seem calm all the time?&lt;/div&gt;&lt;div class="langs_cn"&gt;为什么聪明人总能保持冷静？&lt;/div&gt;&lt;/strong&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&amp;nbsp;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;strong&gt;&lt;div class="langs_en"&gt;Answer from @Domen Grabec&lt;/div&gt;&lt;div class="langs_cn"&gt;来自@Domen Grabec的回答&lt;/div&gt;&lt;/strong&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;If you can solve your problem, then what is the need of worrying?&lt;/div&gt;&lt;div class="langs_cn"&gt;如果你能解决问题，那何虑之有？&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;If you cannot solve it, then what is the use of worrying?&lt;/div&gt;&lt;div class="langs_cn"&gt;如果你不能解决问题，那忧虑又有什么用呢？&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;And if you look at this &lt;a href="http://dict.hjenglish.com/w/logically" class="hjdict" word="logically" target=_blank&gt;logically&lt;/a&gt; not being calm will only work to your disadvantage in many situations:&lt;/div&gt;&lt;div class="langs_cn"&gt;如果你从逻辑的角度来看，不冷静只会起反效果，在很多情况下都一样：&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;There is an important exam coming up and you are freaking out. Panicking might confuse you, inhibit your learning and as a result you might perform worse on the exam.&lt;/div&gt;&lt;div class="langs_cn"&gt;（比如）你正面临一场重要的考试，而你慌得不得了。你的惊慌只会让你思维混乱，它会妨碍你的学习，其结果就是你会在考试中发挥得更糟。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Someone is robbing you and you start to panic. You might get the robber nervous, and he might do something impulsive (like stab you) obviously worsening your position.&lt;/div&gt;&lt;div class="langs_cn"&gt;（再比如）一个人正在抢劫你，而你开始慌了。你可能会让抢劫者变得紧张，而他可能就会做出些过激的事情（比如捅你一刀），显然这回让你的处境更糟。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;You lead a group of people at work and are facing a heavy problem, or an impossible deadline. Well this is the time to inspire people and get the most out of them as possible. That should increase your chances of solving the problem. If you panic you might discourage them, and not only you, but your whole team shall underperform.&lt;/div&gt;&lt;div class="langs_cn"&gt;（再比如）你正带领着一组人一起工作，并且正面临着一个严峻的问题，或者是一个不可能赶上的截止日期。好嘛，你现在需要做的是启发这些人，尽可能让他们做出成果；这会让你解决问题的概率更大一些。如果你慌了，你可能会打击到他们，于是不只是你，你的整个团队都会发挥不佳。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;While you panic, your mind is having a hard time finding a solution to the problem. Even if the solution is only to stay calm and wait for the problem to pass.&lt;/div&gt;&lt;div class="langs_cn"&gt;当你慌张的时候，你的大脑会很难找到解决问题的方法。而解决问题的方法很有可能只是冷静下来并等着问题自己过去。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&amp;nbsp;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;strong&gt;&lt;div class="langs_en"&gt;Answer from @Faith Paul&lt;/div&gt;&lt;div class="langs_cn"&gt;来自@Faith Paul的回答&lt;/div&gt;&lt;/strong&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Intelligent people think before they speak.&lt;/div&gt;&lt;div class="langs_cn"&gt;聪明的人先想再说。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Intelligent people also think rationally.&lt;/div&gt;&lt;div class="langs_cn"&gt;而且，聪明人的思维是理性的。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Instead of freaking out over every little thing, finding drama, or becoming a victim, intelligent people rationalize their problems.&lt;/div&gt;&lt;div class="langs_cn"&gt;聪明人会理性地去分析问题，而不是在每个细枝末节上的慌神、制造情况、或怨天尤人。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Intelligent people don&amp;#39;t prolong their problems. They end their suffering by doing what needs to be done in order for that problem to go away.&lt;/div&gt;&lt;div class="langs_cn"&gt;聪明人不会让问题遗留下来。他们会做那些必要的事以解决问题。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Additionally, I&amp;#39;ve noticed that intelligent people who are stressed find an outlet or take a nap. Bottling up anxiety or pointing fingers like many people do is just going to evoke more stress.&lt;/div&gt;&lt;div class="langs_cn"&gt;还有，我发现聪明人在不堪重负的时候会找个发泄方式，或者小憩一下。很多其他人或把焦虑压制下来，或者在别人身上出气，而这只会让压力更重。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Obviously not all problems can be solved, but my point is that intelligent people handle stress differently.&lt;/div&gt;&lt;div class="langs_cn"&gt;显然，并不是所有的问题都能被解决，我想表达的是：聪明人处理压力的方式时不一样的。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;strong&gt;&lt;br /&gt;\r\n\t&lt;/strong&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;strong&gt;&lt;div class="langs_en"&gt;Answer from @Humberto Rada&lt;/div&gt;&lt;div class="langs_cn"&gt;来自@Humberto Rada的回答&lt;/div&gt;&lt;/strong&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;This could be for several reasons, but one thing I noticed from highly intelligent friends who are calm is that they are able to entertain themselves.&lt;/div&gt;&lt;div class="langs_cn"&gt;原因有很多，而我从我那些冷静的聪明朋友身上发现的一点是：他们有办法自娱自乐。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Yes that is right, they always got something to think about. &lt;/div&gt;&lt;div class="langs_cn"&gt;对，就是这样，他们总有什么东西可以想。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;Its like they enjoy their thoughts more than interacting with other people. &lt;/div&gt;&lt;div class="langs_cn"&gt;好像他们觉得自己的思维比和人交流更有吸引力。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&lt;div class="langs_en"&gt;They are always elaborating on thoughts so they are busy with themselves.&lt;/div&gt;&lt;div class="langs_cn"&gt;他们总是在细细揣摩自己的想法，所以他们自己一个人忙着呢。&lt;/div&gt;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t&amp;nbsp;&lt;/p&gt;\r\n&lt;p&gt;\r\n\t（翻译：能猫）&lt;/p&gt;\r\n&lt;p class="declaration"&gt;\r\n\t声明：本双语文章的中文翻译系iKcamp英语原创内容，转载请注明出处。中文翻译仅代表译者个人观点，仅供参考。如有不妥之处，欢迎指正。&lt;/p&gt;\r\n'</span><span class="p">,</span>
      <span class="na">contentId</span><span class="p">:</span> <span class="mi">1177432</span><span class="p">,</span>
      <span class="na">editorName</span><span class="p">:</span> <span class="s2">"能猫"</span><span class="p">,</span>
      <span class="na">isBest</span><span class="p">:</span> <span class="s2">"Y"</span><span class="p">,</span>
      <span class="na">langs</span><span class="p">:</span> <span class="s2">"en   "</span><span class="p">,</span>
      <span class="na">langsCate</span><span class="p">:</span> <span class="mi">1043</span><span class="p">,</span>
      <span class="na">langsParentCate</span><span class="p">:</span> <span class="mi">1040</span><span class="p">,</span>
      <span class="na">lastUpdateTime</span><span class="p">:</span> <span class="s2">"2017-06-27 00:45:00.530"</span><span class="p">,</span>
      <span class="na">link</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="na">maxPageNum</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="na">newTitle</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="na">picName</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="na">reviewFlag</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">sourceLink</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="na">sourceName</span><span class="p">:</span> <span class="s2">"Quora"</span><span class="p">,</span>
      <span class="na">sourceType</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">sparePic</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="na">subTitle</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
      <span class="na">subjectId</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="na">summary</span><span class="p">:</span> <span class="s2">"为什么有些人总是有办法冷静地面对一切？"</span><span class="p">,</span>
      <span class="na">tags</span><span class="p">:</span> <span class="s2">"智力|职场|学习|双语阅读|励志人生|实用热门|quora|微信热门"</span><span class="p">,</span>
      <span class="na">title</span><span class="p">:</span> <span class="s2">"Quora精选：为什么聪明人总能保持冷静？"</span><span class="p">,</span>
      <span class="na">totalView</span><span class="p">:</span> <span class="mi">112</span>
    <span class="p">},</span>
    <span class="na">message</span><span class="p">:</span> <span class="s2">"success"</span><span class="p">,</span>
    <span class="na">status</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="na">time</span><span class="p">:</span> <span class="kc">null</span>
  <span class="p">};</span>

  <span class="kr">export</span> <span class="p">{</span>
      <span class="nx">detail</span><span class="p">,</span>
      <span class="nx">list</span>
  <span class="p">}</span>
</code></pre>
</div>
<p><br /></p>

<h3 id="astep-3-nbsp--indexjs-a"><a>Step 3.   增加 index.js 主入口文件</a></h3>
<p><code class="highlighter-rouge">index.js</code> 文件中，我们会增加一些公用的函数方法，比如对网络请求封装、开发环境下 log 日志、本地存储等  <br />
<br /></p>

<p>首先，我们把配置信息 <code class="highlighter-rouge">config.js</code> 和假数据 <code class="highlighter-rouge">mock.js</code> 引进来，并正常导出</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="s1">'use strict'</span>
  <span class="kr">import</span> <span class="nx">Promise</span> <span class="nx">from</span> <span class="s1">'../lib/promise'</span>
  <span class="kr">import</span> <span class="nx">config</span> <span class="nx">from</span> <span class="s1">'./config'</span>
  <span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">Mock</span> <span class="nx">from</span> <span class="s1">'./mock'</span>

  <span class="kd">let</span> <span class="nx">util</span> <span class="o">=</span> <span class="p">{</span>
    
  <span class="p">}</span>
  <span class="kr">export</span> <span class="k">default</span> <span class="nx">util</span>
</code></pre>
</div>
<p><br /></p>

<p>第二行代码：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>  <span class="kr">import</span> <span class="nx">Promise</span> <span class="nx">from</span> <span class="s1">'../lib/promise'</span>
</code></pre>
</div>
<p>这一段代码的作用是引入一个实现 Promise 的 <a href="https://github.com/icindy/wxParse">第三方工具库</a>，这样我们就可以在小程序中使用 Promise 方法来解决 <code class="highlighter-rouge">回调地狱</code> 的问题。</p>

<p><strong>注意：</strong> 在新版本的小程序中已经支持了原生 Promise 方法  <br />
<br /></p>

<p>下面我们开始对 util 对象进行公用方法扩展封装：<br />
增加 log 控制台调试功能</p>

<blockquote>
  <p>如果环境配置为dev环境，则打印参数内容</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>let util = {
  isDEV: config.isDev,
  log(){
    this.isDEV &amp;&amp; console.log(...arguments)
  }
}
</code></pre>
</div>

<p><br /></p>

<p>封装 alert 弹出窗口</p>

<blockquote>
  <p>由于开发环境中，经常需要查看一些对象信息，所以增加了 object 类型解析</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">util</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 此处省略部分代码</span>
  <span class="nx">alert</span><span class="p">(</span><span class="nx">title</span> <span class="o">=</span> <span class="s1">'提示'</span><span class="p">,</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">defaultAlertMsg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">'object'</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">content</span><span class="p">){</span>
      <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">isDEV</span> <span class="o">&amp;&amp;</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="o">||</span> <span class="nx">config</span><span class="p">.</span><span class="nx">defaultAlertMsg</span>
    <span class="p">}</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">showModal</span><span class="p">({</span>
      <span class="na">title</span><span class="p">:</span> <span class="nx">title</span><span class="p">,</span>
      <span class="na">content</span><span class="p">:</span> <span class="nx">content</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
<p><br /></p>

<p>wx.showModal 是微信官方提供的 api 方法，具体用法可 <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/api-react.html#wxshowmodalobject">查阅文档</a>  <br />
<br /></p>

<p>封装本地缓存数据的读取功能</p>

<blockquote>
  <p><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/data.html#wxgetstorageobject">wx.getStorage 文档地址</a>  <br />
<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/data.html#wxsetstorageobject">wx.setStorage 文档地址</a></p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">util</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// 此处省略部分代码</span>
  <span class="nx">getStorageData</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="c1">// 将数据存储在本地缓存中指定的 key 中，会覆盖掉原来该 key 对应的内容，这是一个异步接口</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">getStorage</span><span class="p">({</span>
      <span class="na">key</span><span class="p">:</span> <span class="nx">key</span><span class="p">,</span>
      <span class="nx">success</span> <span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">cb</span> <span class="o">&amp;&amp;</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">},</span> 
      <span class="nx">fail</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">errMsg</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span> <span class="sr">/getStorage:fail/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">setStorageData</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">},</span>
  <span class="nx">setStorageData</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">wx</span><span class="p">.</span><span class="nx">setStorage</span><span class="p">({</span>
      <span class="na">key</span><span class="p">:</span> <span class="nx">key</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">value</span><span class="p">,</span>
      <span class="nx">success</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">cb</span> <span class="o">&amp;&amp;</span> <span class="nx">cb</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<p>下一篇中，我们会把网络请求封装起来，并增加本地 <code class="highlighter-rouge">mock</code> 功能</p>

<p><a href="/">返回大纲</a></p>

<p><a href="./ch2-1">上一篇：项目结构设计</a></p>

<p><a href="./ch2-3">下一篇：封装网络请求及 mock 数据</a></p>

  </div>

</article>

        </div>
    </div>
    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">微信小程序教程</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>微信小程序教程</li>
          <li><a href="mailto:ikcamp@qq.com">ikcamp@qq.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/ikcamp"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">ikcamp</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/ikcamp"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">ikcamp</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>iKcamp由沪江Web前端团队中热爱原创和翻译的小伙伴发起，成立于2016年7月，"iK"代表布兰登·艾克（JavaScript之父）。 追随JavaScript这门语言所秉持的精神，崇尚开放和自由的我们一同工作、分享、创作，等候更多有趣跳动的灵魂。
</p>
      </div>
    </div>

  </div>

</footer>

    <script type="text/javascript">
    (function() {
        function canvasTranstion() {
            var waterfallCanvas = function(c, cw, ch) {
                var _this = this;
                this.c = c;
                this.ctx = c.getContext('2d');
                this.cw = cw;
                this.ch = ch;

                this.particles = [];
                this.particleRate = 6;
                this.gravity = .15;


                this.init = function() {
                    this.loop();
                };

                this.reset = function() {
                    this.ctx.clearRect(0, 0, this.cw, this.ch);
                    this.particles = [];
                };

                this.rand = function(rMi, rMa) {
                    return ~~((Math.random() * (rMa - rMi + 1)) + rMi);
                };


                this.Particle = function() {
                    var newWidth = _this.rand(1, 20);
                    var newHeight = _this.rand(1, 45);
                    this.x = _this.rand(10 + (newWidth / 2), _this.cw - 10 - (newWidth / 2));
                    this.y = -newHeight;
                    this.vx = 0;
                    this.vy = 0;
                    this.width = newWidth;
                    this.height = newHeight;
                    this.hue = _this.rand(200, 220);
                    this.saturation = _this.rand(30, 60);
                    this.lightness = _this.rand(30, 60);
                };

                this.Particle.prototype.update = function(i) {
                    this.vx += this.vx;
                    this.vy += _this.gravity;
                    this.x += this.vx;
                    this.y += this.vy;
                };

                this.Particle.prototype.render = function() {
                    _this.ctx.strokeStyle = 'hsla(' + this.hue + ', ' + this.saturation + '%, ' + this.lightness + '%, .05)';
                    _this.ctx.beginPath();
                    _this.ctx.moveTo(this.x, this.y);
                    _this.ctx.lineTo(this.x, this.y + this.height);
                    _this.ctx.lineWidth = this.width / 2;
                    _this.ctx.lineCap = 'round';
                    _this.ctx.stroke();
                };

                this.Particle.prototype.renderBubble = function() {
                    _this.ctx.fillStyle = 'hsla(' + this.hue + ', 40%, 40%, 1)';
                    _this.ctx.fillStyle = 'hsla(' + this.hue + ', ' + this.saturation + '%, ' + this.lightness + '%, .3)';
                    _this.ctx.beginPath();
                    _this.ctx.arc(this.x + this.width / 2, _this.ch - 20 - _this.rand(0, 10), _this.rand(1, 8), 0, Math.PI * 2, false);
                    _this.ctx.fill();
                };

                this.createParticles = function() {
                    var i = this.particleRate;
                    while (i--) {
                        this.particles.push(new this.Particle());
                    }
                };

                this.removeParticles = function() {
                    var i = this.particleRate;
                    while (i--) {
                        var p = this.particles[i];
                        if (p.y > _this.ch - 20 - p.height) {
                            p.renderBubble();
                            _this.particles.splice(i, 1);
                        }
                    }
                };

                this.updateParticles = function() {
                    var i = this.particles.length;
                    while (i--) {
                        var p = this.particles[i];
                        p.update(i);
                    };
                };

                this.renderParticles = function() {
                    var i = this.particles.length;
                    while (i--) {
                        var p = this.particles[i];
                        p.render();
                    };
                };

                this.clearCanvas = function() {
                    this.ctx.globalCompositeOperation = 'destination-out';
                    this.ctx.fillStyle = 'rgba(255,255,255,.06)';
                    this.ctx.fillRect(0, 0, this.cw, this.ch);
                    this.ctx.globalCompositeOperation = 'lighter';
                };

                this.loop = function() {
                    var loopIt = function() {
                        requestAnimationFrame(loopIt, _this.c);
                        _this.clearCanvas();
                        _this.createParticles();
                        _this.updateParticles();
                        _this.renderParticles();
                        _this.removeParticles();
                    };
                    loopIt();
                };

            };

            var isCanvasSupported = function() {
                var elem = document.createElement('canvas');
                return !!(elem.getContext && elem.getContext('2d'));
            };

            var setupRAF = function() {
                var lastTime = 0;
                var vendors = ['ms', 'moz', 'webkit', 'o'];
                for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
                    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
                    window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
                };

                if (!window.requestAnimationFrame) {
                    window.requestAnimationFrame = function(callback, element) {
                        var currTime = new Date().getTime();
                        var timeToCall = Math.max(0, 16 - (currTime - lastTime));
                        var id = window.setTimeout(function() {
                            callback(currTime + timeToCall);
                        }, timeToCall);
                        lastTime = currTime + timeToCall;
                        return id;
                    };
                };

                if (!window.cancelAnimationFrame) {
                    window.cancelAnimationFrame = function(id) {
                        clearTimeout(id);
                    };
                };
            };

            if (isCanvasSupported()) {
                var c = document.getElementById('waterfall');
                var cw = c.width = 100;
                var ch = c.height = 140;
                var waterfall = new waterfallCanvas(c, cw, ch);
                setupRAF();
                waterfall.init();
            }
        }
        canvasTranstion()
    })()
    </script>
</body>

</html>